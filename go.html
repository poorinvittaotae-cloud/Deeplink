<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Open in ReadAWrite App</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial; padding: 16px; line-height: 1.5; }
    .bar { position: sticky; top: 0; padding: 12px 16px; border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,.06); margin-bottom: 16px; }
    .hint { font-size: 14px; opacity: .8; margin-top: 6px; }
    .row { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
    button, a.btn { appearance: none; border: 0; border-radius: 999px; padding: 10px 14px; font-weight: 600; cursor: pointer; text-decoration: none; display: inline-block; }
    .primary { background: #111827; color: white; }
    .ghost { background: #f3f4f6; color: #111827; }
    .ok { color: #059669; font-weight: 600; }
    .hide { display: none; }
  </style>
</head>
<body>

  <div id="iabBar" class="bar hide">
    <div><strong>คุณกำลังเปิดจากในแอป (เช่น Facebook/LINE)</strong></div>
    <div class="hint">เพื่อใช้งานได้ครบ แนะนำเปิดในแอป ReadAWrite หรือเปิดด้วยเบราว์เซอร์หลัก</div>
    <div class="row">
      <button id="openApp" class="primary">เปิดในแอป</button>
      <button id="openBrowser" class="ghost">เปิดด้วยเบราว์เซอร์</button>
      <button id="copyLink" class="ghost">คัดลอกลิงก์</button>
    </div>
    <div id="copied" class="hint hide ok">คัดลอกแล้ว วางใน Chrome/Safari ได้เลย</div>
    <div id="iosTips" class="hint hide">ถ้าไม่เด้ง ให้แตะปุ่ม ⋯ หรือ แชร์ แล้วเลือก "เปิดใน Safari"</div>
  </div>

<script>
  // === ข้อมูล ReadAWrite ===
  const CUSTOM_SCHEME = "readawrite";
  const APP_PACKAGE = "com.readawrite";
  const IOS_APP_STORE_URL = "https://apps.apple.com/th/app/readawrite/id1033832353";
  const ANDROID_PLAY_URL = "https://play.google.com/store/apps/details?id=" + APP_PACKAGE;
  const WEB_FALLBACK_URL = "https://www.readawrite.com/";

  function getParam(name) {
    const p = new URLSearchParams(location.search);
    return p.get(name) || "";
  }
  // รับ path จาก query เช่น ?path=c/xxxx
  const APP_PATH = getParam("path");

  // ตรวจ in-app browser
  const ua = navigator.userAgent || "";
  const isAndroid = /Android/i.test(ua);
  const isIOS = /iPhone|iPad|iPod/i.test(ua);
  const isLine = /Line/i.test(ua);
  const isFBiOS = /\bFBAN\/FBIOS|FBAV/i.test(ua);
  const isFBAndroid = /\bFBAN\/FB4A|FBAV/i.test(ua);
  const isIG = /Instagram/i.test(ua);
  const isInApp = isLine || isFBiOS || isFBAndroid || isIG;

  function buildDeepLink() {
    return `${CUSTOM_SCHEME}://${APP_PATH}`;
  }
  function buildAndroidIntentForApp() {
    return `intent://${APP_PATH}#Intent;scheme=${CUSTOM_SCHEME};package=${APP_PACKAGE};end`;
  }
  function buildAndroidIntentForChrome(url) {
    const escaped = url.replace(/^https?:\/\//, "");
    return `intent://${escaped}#Intent;scheme=https;package=com.android.chrome;end`;
  }

  function openInApp() {
    if (!APP_PATH) {
      window.location.href = WEB_FALLBACK_URL;
      return;
    }
    if (isAndroid) {
      window.location.href = buildAndroidIntentForApp();
      setTimeout(() => { window.location.href = ANDROID_PLAY_URL; }, 1200);
      return;
    }
    if (isIOS) {
      const schemeUrl = buildDeepLink();
      const start = Date.now();
      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      iframe.src = schemeUrl;
      document.body.appendChild(iframe);
      setTimeout(() => {
        const elapsed = Date.now() - start;
        window.location.href = IOS_APP_STORE_URL;
      }, 1000);
      return;
    }
    window.location.href = WEB_FALLBACK_URL;
  }

  function openInBrowser() {
    const currentUrl = window.location.href;
    if (isAndroid && isInApp) {
      window.location.href = buildAndroidIntentForChrome(currentUrl);
      setTimeout(() => { window.location.href = currentUrl; }, 1200);
      return;
    }
    document.getElementById('iosTips').classList.remove('hide');
    alert("บน iPhone/iPad ให้แตะ ⋯ หรือ แชร์ แล้วเลือก 'Open in Safari'");
  }

  async function copyLink() {
    try {
      await navigator.clipboard.writeText(window.location.href);
      document.getElementById('copied').classList.remove('hide');
      setTimeout(() => document.getElementById('copied').classList.add('hide'), 2000);
    } catch {
      alert("คัดลอกไม่สำเร็จ ลองกดค้างที่แถบที่อยู่แล้วเลือกคัดลอก");
    }
  }

  (function init() {
    if (isInApp) {
      document.getElementById('iabBar').classList.remove('hide');
    }
    document.getElementById('openApp').addEventListener('click', openInApp);
    document.getElementById('openBrowser').addEventListener('click', openInBrowser);
    document.getElementById('copyLink').addEventListener('click', copyLink);
  })();
</script>

<h1>กำลังพาคุณไปยัง ReadAWrite...</h1>
<p>ถ้าไม่เด้ง ให้กด “เปิดในแอป” หรือ “เปิดด้วยเบราว์เซอร์” ด้านบน</p>

</body>
</html>
